---
title: "Noxious Plants"
output:
  pdf_document: default
  word_document: default
header-includes:
 - \usepackage[width=\textwidth]{caption}
 - \usepackage{wrapfig}
 - \usepackage[font=small,labelfont=bf]{caption}
always_allow_html: yes
csl: ../citations/citations/apa.csl
bibliography: ../citations/citations/citations.bib
link-citations: yes
---

\vspace{-1cm}

One of the first acts in the life of a plant, as a seed, is to move. Generally seeds travel only short distances, but less common long distance movements are known to occur naturally (Section X.X), and long distance movement occurs regularly via humans. The long distance movement of seeds by humans, in recent history *i.e.* the last couple thousand years, may result in the seed germinating and the population (if any) which results from it surviving for only a few generations (*waif*) (@nesom2000non). A seed may also produce a population which is able to persist for many generations in the new ecosystem, and even disperse and spread out across their new landscape (*naturalized*); many of these species are readily incorporated into the existing vegetation and do little to alter it (@nesom2000non, @pyvsek2010invasive). A subset of these species which are able to naturalize may displace considerable amounts of the plant species already in the landscape, and in so doing alters the composition of species at ecological sites (*noxious*), hence also the functioning of these sites (*invasive*) (@davies2011plant, @evans2001exotic, @pyvsek2012global, @noxious2023blm,  *and reviewed in* @ehrenfeld2010ecosyste @pyvsek2010invasive).  That a few species can alter the properties of landscapes is at the core of the Ecological Sites. While all invasive plants are noxious, not all noxious plants are invasive, as can be seen from a number of native species which act as aggressive weeds in disturbed settings and which prevent natural succession.

Noxious and invasive species adversely affect nearly all ecosystem services offered by natural areas, increase fire frequency and intensity, and have enormous economic impacts (*reviwed in* @ehrenfeld2010ecosystem, @d1992biological, @duncan2004assessing, @fantle2022economic, @crystal2021economic). Invasive species at landscape scales have been shown to decrease plant species richness, taxonomic, functional and structural diversity leading to declines in habitat heterogeneity and adversely affecting wildlife (@keeley2012fire, @ehrenfeld2010ecosystem, @klinger2017alternative). They pose serious threats to the well being of both wildlife, livestock, and humans, via interactions with historic land management alterations, to the fire cycle (@d1992biological, @keeley2012fire, @). The economic impacts of invasive species include enormous amounts of funds being channeled into their treatment to reduce fuel loads (), treatments to curtail their spread into new areas (), and losses in economic activity e.g. by displacement of grasses more suitable as forage for livestock (). 

Most land managers in the Western cold deserts (The Colorado Plateau, Great Basin, and Columbia Plateau) consider noxious annual grasses to pose the greatest challenge towards maintaining ecosystems which allow for multiple uses (@chambers2009cold). Of concern to our office is the increasing adpation of cheatgrass (*Bromus tectorum*), which is already present throughout the field office, towards higher elevation sites (@smith2022elevational). Based on the limited evidence currently available the effect of encroachment of invasive species is of more adverse affect than is attributable to climate change or drought, although synergistic interactions between invasive species and drought still occurr  (@clarke2005long, @lopez2022global). 

# Methods

```{r load libraries}
library(sf)
library(tidyverse)

source('functions.R')
p <- file.path('..', 'data', 'raw')
f <- list.files(p)
```

Creation and maintenance of registries of noxious and invasive species often falls on the Department of Agriculture of the Federal and State governments (@quinn2013navigating). Given the focus of these agencies, these lists are generally focused on arable lands used for crop production, with minimal effort placed on natural settings (@quinn2013navigating). To better characterize the condition of invasive and noxious species in natural areas, BLM staff co-developed definitive lists of status of species regarding their Noxious or Invasive status in 2019. 

```{r download records from BIEN, eval = F}

fp <- file.path('..', '..',  'UFO_cartography/BLM_CO_ADMU')
ufo_bbox <- st_read(
  file.path(fp, list.files(fp, pattern = '.shp$')), quiet = T) %>% 
  st_transform(4326) %>% 
  st_bbox()

bien_recs <- BIEN::BIEN_occurrence_box(min.lat  = ufo_bbox[2],
                                 max.lat  = ufo_bbox[4],
                                 min.long = ufo_bbox[1],
                                 max.long = ufo_bbox[3])
write.csv(bien_recs, file.path('..', 'data', 'raw', 'bien_occurrence_from_bbox.csv'))

rm(fp, ufo_bbox, bien_recs)
```

```{r identify invasive species from CNHP, eval = F}

attributes <- read.csv( file.path(p, f[grep('Attributes', f)])) %>% 
  distinct(Species, Noxious ) %>% 
  filter(Noxious == 'YES')

invasive_species <- read.csv(file.path(p, f[grep('Values', f)])) %>% 
  select(National_USDASymbol, National_SciName_noAuthority, Ack_SciName_noAuthority,  National_NativeStatus, 
         CONox_Status, Invasiveness, IRank, IRank_Score) %>% 
  mutate(across(.col = everything(), ~ na_if(., ''))) %>% 
  drop_na(National_USDASymbol) %>% 
  filter(National_NativeStatus %in% c('Introduced', 'Both')) %>% 
  unite(CONox_Status:IRank_Score, col = 'Invasive' , remove = F, na.rm = T) %>% 
  mutate(Invasive = na_if(Invasive, "")) %>% 
  mutate(Invasive = if_else(!is.na(Invasive), T, F))

attributes[!attributes$Species %in% invasive_species$National_USDASymbol,]
# these mostly due to the CPNWH being finer in taxonomy, e.g. if only an infraspecific 
# taxon known to the state, than this recorded.

aim_synonyms <-  read.csv( file.path(p, f[grep('AIM_invasive', f)])) 

invasive_species %>% 
  mutate(National_USDASymbol = if_else(
    National_USDASymbol == 'TACH$', 'TACH2', National_USDASymbol
  )) 
invasive_species <- bind_rows(aim_synonyms, invasive_species)

write.csv(invasive_species, row.names = F, 
          file.path('..', 'data', 'processed', 'Introducted_species_CO.csv'))

rm(attributes, invasive_species)
```

To develop a list of invasive plant species for the study area 'IRanks', a semi-quantitative expert based assessment of introduced species, were extracted from the C-Values prepared by the Colorado Natural Heritage Program (Section X.X) (@moore2004iranks, @cnhp2020fqi).  This was combined with an AIM species attribute table extract from the vicinity of the study area, the latter dataset contained a handful of synonyms which included codes not present in the former.

```{r import species richness data and tie to plots}

plot_char <- read.csv( file.path(p, f[grep('Characterization', f)]) ) %>% 
  select(PrimaryKey, Easting, Northing) %>% 
  drop_na() 

invasive_species <- read.csv(
  file.path('..', 'data', 'processed', 'Introducted_species_CO.csv') ) %>% 
  select(National_USDASymbol:Invasive)

spp_alpha <- read.csv( file.path(p, f[grep('Richness.csv$', f)])) %>% 
  select(PrimaryKey, SpeciesList, abundance, distribution) %>% 
  right_join(., plot_char, by = 'PrimaryKey') %>% 
  st_as_sf(coords = c('Easting', 'Northing'), crs = 4269) %>% 
  st_transform(26913)

pts <- st_read(
  '/media/sagesteppe/ExternalHD/aimDB/data/raw/AIM_Sample_Design/AIM_Design_Stratification.shp',
                quiet = T) %>% 
  st_transform(26913) %>% 
  st_buffer(100) %>% 
  select(PLOTID, STRATUM)

spp_alpha <- spp_alpha %>% 
  st_transform(26913)

esd_class <- read.csv( file.path(p, f[grep('Tracking', f)]) ) %>% 
  filter(STATUS == 'SAMPLED') %>% 
  mutate(ECO.SITE = if_else(ECO.SITE.MATCHED == F, 'UNKNOWN', ECO.SITE)) %>% 
  select(PlotID = PLOT.ID, ECO.SITE)

spp_alpha <- st_intersection(pts, spp_alpha) %>% 
  left_join(., esd_class, by = c('PLOTID' = 'PlotID')) %>% 
  mutate(ECO.SITE = if_else(PLOTID == 'GR-035', 'R036XY114CO', ECO.SITE),
         PLOTID = if_else(PLOTID == 'GR-035', 'GR-025', PLOTID)) 

rm(plot_char, pts, esd_class)
```


```{r import LPI data and tie to plots}

lpi <- read.csv( file.path(p, f[grep('LPIRAW', f)]) ) %>% 
  select(PrimaryKey, TopCanopy:SoilSurface) %>% 
  filter(PrimaryKey %in% spp_alpha$PrimaryKey) %>% 
  mutate(TopCanopy = na_if(TopCanopy, 'None'),
               TopCanopy = na_if(TopCanopy, 'N')) %>% 
  mutate(across(.cols = everything(), ~ na_if(.x, ""))) %>% 
  unite(col = 'All_species',  TopCanopy:SoilSurface,  sep = " ", na.rm = T, remove = F) 

Invasive <- lapply(lpi$All_species, inv_present, invasive_species$National_USDASymbol)
Invasive <- unlist(Invasive)
lpi <- bind_cols(lpi, Invasive = Invasive)

# percent cover of all plants
lpi_sum <- lpi %>% 
  group_by(PrimaryKey) %>% 
  summarize(Vascular_Intercepts =  150 - sum(is.na(TopCanopy)),
         Invasive_Intercepts = sum(Invasive))

# join up
lpi_sum <- left_join(lpi_sum, select(spp_alpha, PLOTID, PrimaryKey) %>% 
                       distinct(), by = 'PrimaryKey') %>% 
  select(-PrimaryKey) %>% 
  mutate(Proportion_Invasive = Invasive_Intercepts/Vascular_Intercepts) %>% 
  st_as_sf()

# Cover of individual invasive species by plots

lpi2 <- lpi %>% 
  select(PrimaryKey:Lower4, -All_species) %>% 
  pivot_longer(!PrimaryKey, values_to = 'SYMBOL')  %>% 
  filter(!SYMBOL %in% c('L', 'WL', 'HL')) %>% 
  drop_na(SYMBOL) %>% 
  group_by(PrimaryKey, SYMBOL) %>% 
  count(SYMBOL) %>% 
  filter(SYMBOL %in% invasive_species$National_USDASymbol) %>% 
  ungroup()

invasive_sum <- left_join(lpi2, select(spp_alpha, PLOTID, PrimaryKey) %>% 
                       distinct(), by = 'PrimaryKey') %>% 
  select(-PrimaryKey, -geometry) %>% 
  left_join(., select( invasive_species, National_USDASymbol, Invasive), 
            by = c('SYMBOL' ='National_USDASymbol'))

rm(Invasive, inv_present)
```


```{r Join invasive species and process raw data}

inv <- spp_alpha %>% 
  left_join(., invasive_species, by = c('SpeciesList' = 'National_USDASymbol')) %>% 
  group_by(PLOTID) %>% 
  add_count(name = 'No_Spp') %>% 
  group_by(PLOTID, National_NativeStatus) %>%
  add_count(name = 'No_Introduced') %>% 
  group_by(PLOTID, Invasive) %>%  
  add_count(name = 'No_Invasive') 

inv_richness <- inv %>% 
  drop_na(National_SciName_noAuthority) %>% 
  mutate(Prop_Int = No_Introduced/No_Spp,
           Prop_Inv = No_Invasive/No_Spp)

```



```{r Rescale three Proportions from zero to one and sum together for cartography}

inv_carto <- inv_richness %>% 
  mutate(across(.cols = Prop_Int:Prop_Inv, ~ scales::rescale(., to = c(0,1)))) %>% 
  select(PLOTID, Prop_Int, Prop_Inv) %>% 
  st_drop_geometry()

inv_carto <- left_join(lpi_sum, inv_carto, by = "PLOTID") %>% 
  distinct(PLOTID, .keep_all = T) %>% 
  rowwise() %>% 
  mutate(Prop_Inv2 = sum(Proportion_Invasive + Prop_Inv + Prop_Int, na.rm = T)/3)

ggplot() +
  geom_sf(data = inv_carto, aes(fill = Prop_Inv2), shape = 23, size = 2) +
  scale_fill_distiller(palette = "RdYlGn", direction = -1)

```




```{r Do Certain Ecosites appear less resistant to invasion}

group_by()

```


```{r Which Species of Invasives compose most of the cover on plots}

vasc_total <- select(lpi_sum, PLOTID, Vascular_Intercepts) %>% distinct()

r <- left_join(select(lpi_sum, PLOTID, Vascular_Intercepts) %>% distinct(), 
               invasive_sum, by= 'PLOTID')  %>% 
  rowwise() %>% 
  mutate(Prop_Cover = n/Vascular_Intercepts) %>% 
  filter(Prop_Cover <= 1.0) # need to see why SD-338
  
r_locations <- r %>% 
  group_by(SYMBOL) %>% 
  add_count(SYMBOL) %>% 
  filter(Invasive == T)


ne_weeds <- c('ALDE','CACH42','CADR','CIAR4', 'COAR4', 
                'CYOF', 'GYEL', 'LEDE', 'PHPR3', 'POAR8', 'POAV', 'TARA')
ne_labels <- filter(invasive_species, National_USDASymbol %in% ne_weeds) %>% 
  pull(National_SciName_noAuthority)
r_locations_ne <- r_locations %>% filter(SYMBOL %in% ne_weeds)

r_locations_ne  %>% 
  st_buffer(2500) %>% 
  st_bbox()

ggplot() +
  geom_sf(data = r_locations_ne, aes(color = SYMBOL), shape = 7, size = 3) +
  theme_bw() +
  labs(title = 'Invasive Species in the NE Field Office') +
  theme(
    plot.title =  element_text(hjust = 0.5),
    axis.title.x=element_blank(),
    axis.text.x=element_blank(),
    axis.ticks.x=element_blank(),
    axis.title.y=element_blank(),
    axis.text.y=element_blank(),
    axis.ticks.y=element_blank(),
    panel.spacing = unit(0.1, "lines")
    ) + 
  scale_color_manual('Species', 
                     values = colorspace::qualitative_hcl(12, palette = "Dark 3"),
                     labels=ne_labels)

r_locations <- r_locations %>% filter(!SYMBOL %in% ne_weeds)

ggplot() +
  geom_sf(data = r_locations) +
  facet_wrap(~SYMBOL) +
  theme_bw() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        panel.spacing = unit(0.1, "lines")
        )

```

```{r Which species of invasives are most common across the field office}


```



